<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Final Fantasy 3 Style RPG - A comprehensive turn-based RPG experience">
    <meta name="author" content="RPG Development Team">
    <meta name="keywords" content="RPG, game, final fantasy, turn-based, web game">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="Final Fantasy 3 Style RPG">
    <meta property="og:description" content="A comprehensive turn-based RPG experience">
    <meta property="og:image" content="/assets/images/og-image.png">
    <meta property="og:url" content="https://your-domain.com">
    <meta property="og:type" content="website">

    <title>Final Fantasy 3 Style RPG</title>

    <!-- Game Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-canvas {
            border: 2px solid #333;
            background: #000;
            max-width: 100%;
            max-height: 100%;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease-out;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            background: linear-gradient(45deg, #00ff88, #0088ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .loading-progress {
            width: 300px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #0088ff);
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-text {
            font-size: 1rem;
            color: #ccc;
        }

        #error-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            text-align: center;
        }

        .error-title {
            color: #ff4444;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .error-details {
            color: #ccc;
            margin-bottom: 2rem;
        }

        .retry-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .retry-button:hover {
            background: #cc3333;
        }

        @media (max-width: 768px) {
            .loading-title {
                font-size: 2rem;
            }

            #game-canvas {
                width: 100vw;
                height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>

        <!-- Loading Screen -->
        <div id="loading-screen">
            <h1 class="loading-title">Final Fantasy 3 Style RPG</h1>
            <div class="loading-progress">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <div class="loading-text" id="loading-text">Loading game assets...</div>
        </div>

        <!-- Error Screen -->
        <div id="error-screen">
            <div class="error-message">
                <h2 class="error-title">Game Load Error</h2>
                <div class="error-details" id="error-details">
                    There was an error loading the game. Please check your browser compatibility and try again.
                </div>
                <button class="retry-button" onclick="location.reload()">Retry</button>
            </div>
        </div>
    </div>

    <!-- Game Script -->
    <script type="module">
        import { RPGEngine } from './src/core/RPGEngine.js';

        // Game configuration
        const gameConfig = {
            canvasId: 'game-canvas',
            width: 1280,
            height: 720,
            debug: true,
            performanceMonitoring: true,
            rpgMode: true,
            autoSaveOnExit: true
        };

        // Global game instance
        window.gameEngine = null;

        // Loading management
        let loadingProgress = 0;
        const loadingText = document.getElementById('loading-text');
        const loadingBar = document.getElementById('loading-bar');
        const loadingScreen = document.getElementById('loading-screen');
        const errorScreen = document.getElementById('error-screen');

        function updateLoading(progress, message = '') {
            loadingProgress = Math.min(progress, 100);
            loadingBar.style.width = `${loadingProgress}%`;

            if (message) {
                loadingText.textContent = message;
            }
        }

        function showError(message, details = '') {
            loadingScreen.classList.add('hidden');
            errorScreen.style.display = 'flex';
            document.getElementById('error-details').textContent = `${message}\n\n${details}`;
        }

        function hideLoading() {
            loadingScreen.classList.add('hidden');
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }

        // Browser compatibility check
        function checkBrowserSupport() {
            const requirements = {
                webgl: !!document.createElement('canvas').getContext('webgl'),
                webgl2: !!document.createElement('canvas').getContext('webgl2'),
                webAudio: !!(window.AudioContext || window.webkitAudioContext),
                localStorage: !!window.localStorage,
                indexedDB: !!window.indexedDB,
                serviceWorker: !!navigator.serviceWorker,
                es6: typeof Symbol === 'function' && typeof Promise === 'function'
            };

            const missing = Object.entries(requirements)
                .filter(([_, supported]) => !supported)
                .map(([feature, _]) => feature);

            if (missing.length > 0) {
                showError(
                    'Browser Compatibility Issue',
                    `Your browser doesn't support: ${missing.join(', ')}. Please use a modern browser like Chrome, Firefox, or Edge.`
                );
                return false;
            }

            return true;
        }

        // Initialize game
        async function initGame() {
            try {
                // Check browser support
                if (!checkBrowserSupport()) {
                    return;
                }

                updateLoading(10, 'Initializing game engine...');

                // Create game engine
                window.gameEngine = new RPGEngine('game-canvas', gameConfig);

                updateLoading(30, 'Loading game systems...');

                // Initialize game systems (this would be expanded based on actual game structure)
                await initializeGameSystems();

                updateLoading(80, 'Starting game...');

                // Start the game
                window.gameEngine.start();

                updateLoading(100, 'Game ready!');
                hideLoading();

                console.log('Final Fantasy 3 Style RPG initialized successfully');

            } catch (error) {
                console.error('Game initialization error:', error);
                showError(
                    'Game Initialization Failed',
                    `Error: ${error.message}\n\nPlease check the console for more details.`
                );
            }
        }

        // Initialize game systems (placeholder for actual implementation)
        async function initializeGameSystems() {
            // This is where you would load your game scenes, characters, maps, etc.
            // For now, it's a placeholder

            updateLoading(40, 'Loading character system...');
            // Load character classes, jobs, etc.

            updateLoading(50, 'Loading map system...');
            // Load tile maps, world data, etc.

            updateLoading(60, 'Loading battle system...');
            // Load battle mechanics, enemies, etc.

            updateLoading(70, 'Loading UI system...');
            // Load menus, HUD, etc.

            // Simulate loading time
            await new Promise(resolve => setTimeout(resolve, 1000));
        }

        // Handle window resize
        function handleResize() {
            if (window.gameEngine && window.gameEngine.resize) {
                window.gameEngine.resize(window.innerWidth, window.innerHeight);
            }
        }

        // Handle visibility change (pause/resume)
        function handleVisibilityChange() {
            if (window.gameEngine) {
                if (document.hidden) {
                    window.gameEngine.pause();
                } else {
                    window.gameEngine.resume();
                }
            }
        }

        // Event listeners
        window.addEventListener('resize', handleResize);
        window.addEventListener('visibilitychange', handleVisibilityChange);

        // Global error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showError('Unexpected Error', event.error.message);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showError('Unhandled Error', event.reason.message || event.reason);
        });

        // Start game when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
    </script>
</body>
</html>