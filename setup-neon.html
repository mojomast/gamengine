
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff206e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Setup Neon">
    <meta name="format-detection" content="telephone=no">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23ff206e'/><text x='50' y='55' font-size='40' text-anchor='middle' fill='white'>⚙️</text></svg>">
    <title>Setup Neon Clicker Project</title>
    <link rel="stylesheet" href="./shared/styles.css">
</head>
<body>
    <!-- Skip Links for Screen Readers -->
    <a href="#main-content" class="skip-link sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-blue-600 focus:text-white focus:px-4 focus:py-2 focus:rounded">Skip to main content</a>

    <main id="main-content">
        <header role="banner">
            <h1>Setting up Neon Clicker Project...</h1>
        </header>

        <section aria-labelledby="setup-description">
            <h2 id="setup-description" class="sr-only">Setup Description</h2>
            <p>This page adds the Neon Clicker Battle project to your localStorage for the project manager.</p>
        </section>

        <section aria-labelledby="setup-status" aria-live="polite" aria-atomic="true">
            <h2 id="setup-status" class="sr-only">Setup Status</h2>
            <div id="status" role="status"></div>
        </section>
    </main>

    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    <div id="sr-status" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

    <script>
        // Screen reader announcement function
        function announceToScreenReader(message, priority = 'polite') {
            const target = priority === 'assertive' ? 'sr-status' : 'sr-announcements';
            const announcer = document.getElementById(target);
            if (announcer) {
                announcer.textContent = message;
                if (priority === 'assertive') {
                    setTimeout(() => { announcer.textContent = ''; }, 1000);
                }
            }
        }

        // Initialize accessibility features
        function initializeAccessibility() {
            // Announce page load
            setTimeout(() => {
                announceToScreenReader('Setup page loaded. Beginning project setup automatically.');
            }, 500);

            // High contrast mode support
            const highContrast = window.matchMedia('(prefers-contrast: high)').matches;
            if (highContrast) {
                document.body.classList.add('high-contrast');
            }

            // Reduced motion support
            const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (reducedMotion) {
                document.body.classList.add('reduced-motion');
            }
        }

        // Setup project with accessibility announcements
        async function setupNeonProject() {
            try {
                announceToScreenReader('Loading Neon Clicker project configuration...', 'assertive');

                const project = {
            "id": "neon-clicker-demo-1",
            "name": "Neon Clicker Battle",
            "description": "A 2D game engine demo with player character system and cyberpunk theme",
            "template": "game-engine",
            "version": "1.0.0",
            "createdAt": "2025-09-17T13:59:00.000Z",
            "files": {
                "index.html": `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Engine Demo - Neon Clicker Battle</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <nav class="nav-buttons">
            <button class="demo-btn" onclick="window.open('../project-manager.html', '_blank')" title="Open the project manager to create and manage game projects">📁 Open Project Manager</button>
            <button class="demo-btn" onclick="window.open('docs/MASTER-ARCHITECTURE.md', '_blank')" title="Access system configuration and architecture documentation">⚙️ Configure Systems</button>
            <button class="demo-btn" onclick="window.open('README.md', '_blank')" title="View comprehensive documentation for the game engine">📖 View Documentation</button>
        </nav>
        <h1>🎮 GAME ENGINE DEMO - WITH PLAYER CHARACTER 🎮</h1>
        <p>A comprehensive 2D game engine with integrated player character system featuring movement, abilities, and visual effects</p>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="1024" height="768" aria-label="Game Engine Demo Canvas - Interactive particle effects and player character movement" role="img" tabindex="0"></canvas>

        <!-- New UI Sections -->
        <div id="characterStats" class="ui-panel character-stats-panel">
            <h3>Character Stats</h3>
            <div id="characterInfo"></div>
        </div>

        <div id="inventoryGrid" class="ui-panel inventory-panel">
            <h3>Inventory</h3>
            <div id="inventorySlots" class="inventory-slots"></div>
        </div>

        <div id="abilityHotbar" class="ui-panel ability-panel">
            <h3>Abilities</h3>
            <div id="abilitySlots" class="ability-slots"></div>
        </div>

        <div id="dialogPanel" class="ui-panel dialog-panel">
            <div id="dialogText"></div>
            <div id="dialogChoices"></div>
        </div>

        <div class="loading" id="loadingScreen">
            <h2>INITIALIZING GAME ENGINE...</h2>
            <div class="spinner"></div>
        </div>

        <div class="engine-info">
            <h3>🔧 Engine Features</h3>
            <div class="feature">
                <span>Scene Management:</span>
                <span class="feature-status">✅ Active</span>
            </div>
            <div class="feature">
                <span>Input System:</span>
                <span class="feature-status">✅ Responsive</span>
            </div>
            <div class="feature">
                <span>Player Character System:</span>
                <span class="feature-status">✅ Integrated</span>
            </div>
            <div class="feature">
                <span>Movement & Physics:</span>
                <span class="feature-status">✅ 8-Directional</span>
            </div>
            <div class="feature">
                <span>Particle Effects:</span>
                <span class="feature-status">✅ Dynamic</span>
            </div>
            <div class="feature">
                <span>Animation System:</span>
                <span class="feature-status">✅ Smooth</span>
            </div>
            <div class="feature">
                <span>Health/Energy System:</span>
                <span class="feature-status">✅ Visual HUD</span>
            </div>
            <div class="feature">
                <span>Trail Effects:</span>
                <span class="feature-status">✅ Real-time</span>
            </div>
            <div class="feature">
                <span>Ability System:</span>
                <span class="feature-status">✅ Energy-based</span>
            </div>
            <div class="feature">
                <span>UI Framework:</span>
                <span class="feature-status">✅ Modular</span>
            </div>
            <div class="feature">
                <span>Audio Manager:</span>
                <span class="feature-status">✅ Spatial</span>
            </div>
            <div class="feature">
                <span>Game Objects:</span>
                <span class="feature-status">✅ Component-based</span>
            </div>
            <div class="feature">
                <span>State Management:</span>
                <span class="feature-status">✅ Persistent</span>
            </div>
        </div>

        <div class="controls">
            <div class="controls-title">🎯 Player Controls</div>
            <div class="control-item">
                <span class="key">WASD</span> Move Player Character
            </div>
            <div class="control-item">
                <span class="key">↑↓←→</span> Alternative Movement
            </div>
            <div class="control-item">
                <span class="key">SPACE</span> Player Attack (15 Energy)
            </div>
            <div class="control-item">
                <span class="key">Q</span> Dash Left (25 Energy)
            </div>
            <div class="control-item">
                <span class="key">E</span> Dash Right (25 Energy)
            </div>
            <div class="control-item">
                <span class="key">CLICK</span> Create Particle Effects
            </div>
            <div class="control-item">
                <span class="key">ESC</span> Pause/Menu
            </div>
        </div>

        <!-- Demo Control Buttons -->
        <div class="demo-controls">
            <button id="demoCharacterBtn" class="demo-btn" aria-label="Character demo button - View character stats and information">📊 Character Demo</button>
            <button id="demoInventoryBtn" class="demo-btn" aria-label="Inventory demo button - View inventory management system">🎒 Inventory Demo</button>
            <button id="demoAbilityBtn" class="demo-btn" aria-label="Ability demo button - View ability system and hotbar">⚡ Ability Demo</button>
            <button id="demoDialogBtn" class="demo-btn" aria-label="Dialog demo button - View dialog system with choices">💬 Dialog Demo</button>
        </div>

        <!-- Save/Load Control Panel -->
        <div id="saveLoadPanel" class="ui-panel" style="top: 10px; right: 10px; width: 200px; background: rgba(0, 0, 0, 0.9); border: 2px solid #00f593;">
            <h3 style="color: #ffd700; margin-bottom: 10px;">💾 Game Save</h3>
            <div id="saveSlots" style="margin-bottom: 10px;">
                <button id="saveSlot1" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Save to slot 1">Save Slot 1</button>
                <button id="loadSlot1" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Load from slot 1">Load Slot 1</button>
                <button id="saveSlot2" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Save to slot 2">Save Slot 2</button>
                <button id="loadSlot2" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Load from slot 2">Load Slot 2</button>
                <button id="saveSlot3" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Save to slot 3">Save Slot 3</button>
                <button id="loadSlot3" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Load from slot 3">Load Slot 3</button>
            </div>
            <button id="exportSave" class="demo-btn" style="width: 100%; margin-bottom: 5px;" aria-label="Export game save">📤 Export Save</button>
            <button id="importSave" class="demo-btn" style="width: 100%;" aria-label="Import game save">📥 Import Save</button>
            <input type="file" id="importFileInput" style="display: none;" accept=".json">
        </div>

        <!-- Save/Load Notification -->
        <div id="saveNotification" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.9); color: #00f593; padding: 20px; border: 2px solid #00f593; border-radius: 8px; font-size: 16px; text-align: center; display: none; z-index: 2000;">
            <div id="notificationText">Game Saved!</div>
        </div>
    </div>
</body>
<script src="script.js"></script>
</html>`,
                "styles.css": `@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Orbitron', monospace;
    background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
    color: #ffffff;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

.header {
    background: rgba(0, 0, 0, 0.8);
    padding: 15px;
    text-align: center;
    border-bottom: 2px solid #00f593;
    box-shadow: 0 2px 10px rgba(0, 245, 147, 0.3);
}

.header h1 {
    font-family: 'Press Start 2P', cursive;
    font-size: 24px;
    color: #ff206e;
    text-shadow: 0 0 10px #05d9e8;
    margin-bottom: 5px;
}

.header p {
    font-size: 14px;
    color: #00f593;
}

.nav-buttons {
    position: absolute;
    top: 15px;
    left: 15px;
    display: flex;
    gap: 8px;
    z-index: 100;
}

.game-container {
    flex: 1;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

#gameCanvas {
    border: 3px solid #ffd700;
    border-radius: 10px;
    box-shadow:
        0 0 20px rgba(255, 215, 0, 0.5),
        inset 0 0 20px rgba(0, 0, 0, 0.3);
    background: #000;
    max-width: 100%;
    max-height: 100%;
}

.loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 1000;
}

.loading h2 {
    font-family: 'Press Start 2P', cursive;
    color: #ff206e;
    margin-bottom: 20px;
    animation: pulse 1.5s infinite;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #00f593;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.controls {
    position: absolute;
    bottom: 10px;
    left: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #00f593;
    font-size: 12px;
    text-align: center;
}

.controls-title {
    color: #ffd700;
    font-weight: bold;
    margin-bottom: 5px;
}

.control-item {
    display: inline-block;
    margin: 0 10px;
    color: #ffffff;
}

.demo-controls {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 100;
}

.demo-btn {
    background: linear-gradient(45deg, #ff206e, #05d9e8);
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 11px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.demo-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(255, 32, 110, 0.5);
}

.demo-btn:active {
    transform: scale(0.95);
}

.key {
    background: #333;
    border: 1px solid #666;
    border-radius: 3px;
    padding: 2px 6px;
    font-family: monospace;
    color: #00f593;
}

.engine-info {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ff206e;
    font-size: 11px;
    min-width: 200px;
}

.engine-info h3 {
    color: #ff206e;
    margin-bottom: 8px;
    font-size: 12px;
}

.feature {
    display: flex;
    justify-content: space-between;
    margin: 3px 0;
    color: #ffffff;
}

.feature-status {
    color: #00f593;
}

@media (max-width: 768px) {
    .header h1 {
        font-size: 18px;
    }

    .game-container {
        padding: 10px;
    }

    .controls, .engine-info {
        position: relative;
        margin: 10px;
    }

    .engine-info {
        order: -1;
    }
}

/* Virtual gamepad for mobile */
.virtual-gamepad {
    display: none;
}

@media (max-width: 768px) and (orientation: landscape),
       (max-width: 480px) {
    .virtual-gamepad {
        display: flex !important;
    }
}

/* New UI Panel Styles */
.ui-panel {
    position: absolute;
    background: rgba(0, 0, 0, 0.85);
    border: 2px solid #00f593;
    border-radius: 8px;
    padding: 12px;
    font-size: 12px;
    color: #ffffff;
    backdrop-filter: blur(5px);
    box-shadow: 0 4px 15px rgba(0, 245, 147, 0.3);
    z-index: 100;
}

.ui-panel h3 {
    color: #ffd700;
    margin: 0 0 8px 0;
    font-size: 14px;
    text-align: center;
}

.character-stats-panel {
    top: 100px;
    left: 10px;
    width: 250px;
    max-height: 300px;
    overflow-y: auto;
}

.inventory-panel {
    top: 100px;
    right: 10px;
    width: 300px;
    max-height: 400px;
}

.inventory-slots {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 4px;
}

.inventory-slot {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid #666;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 10px;
}

.inventory-slot:hover {
    background: rgba(0, 245, 147, 0.2);
    border-color: #00f593;
}

.inventory-slot.filled {
    background: rgba(255, 215, 0, 0.2);
}

.ability-panel {
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    width: 600px;
}

.ability-slots {
    display: flex;
    gap: 8px;
    justify-content: center;
}

.ability-slot {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #666;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
}

.ability-slot:hover {
    background: rgba(5, 217, 232, 0.2);
    border-color: #05d9e8;
}

.ability-slot.ready {
    border-color: #00f593;
    background: rgba(0, 245, 147, 0.1);
}

.ability-slot.cooldown {
    border-color: #666;
    background: rgba(255, 255, 255, 0.05);
}

.dialog-panel {
    bottom: 10px;
    left: 10px;
    right: 10px;
    max-height: 100px;
    display: none;
}

.dialog-panel.active {
    display: block;
}

#dialogText {
    margin-bottom: 8px;
    line-height: 1.4;
}

#dialogChoices {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.dialog-choice {
    background: rgba(0, 245, 147, 0.1);
    border: 1px solid #00f593;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 11px;
}

.dialog-choice:hover {
    background: rgba(0, 245, 147, 0.3);
}

/* Retro scanlines effect */
.game-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 255, 0, 0.03) 2px,
        rgba(0, 255, 0, 0.03) 4px
    );
    pointer-events: none;
    z-index: 5;
}`,
                "script.js": `// Game Engine Demo - Player Character Integration
async function createSimpleDemo() {
    // Create a simple canvas demo
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let time = 0;
    // Use global variables for save/load functionality
    let particles = globalParticles;
    let score = globalScore;
    let clicks = globalClicks;

    // Player character class - Core component for character-based games
    class Player {
        constructor(x, y) {
            // Position and Movement Properties
            this.x = x;
            this.y = y;
            this.width = 24;
            this.height = 32;
            this.speed = 250;
            this.vx = 0;
            this.vy = 0;

            // Health and Energy System
            this.health = 100;
            this.maxHealth = 100;
            this.energy = 100;
            this.maxEnergy = 100;

            // Visual and Animation Properties
            this.facing = 'right';
            this.isMoving = false;
            this.animTime = 0;
            this.trail = [];
        }

        update(dt, keys) {
            this.vx = 0;
            this.vy = 0;
            this.isMoving = false;

            // Movement input
            if (keys['KeyW'] || keys['ArrowUp']) {
                this.vy = -this.speed;
                this.isMoving = true;
            }
            if (keys['KeyS'] || keys['ArrowDown']) {
                this.vy = this.speed;
                this.isMoving = true;
            }
            if (keys['KeyA'] || keys['ArrowLeft']) {
                this.vx = -this.speed;
                this.facing = 'left';
                this.isMoving = true;
            }
            if (keys['KeyD'] || keys['ArrowRight']) {
                this.vx = this.speed;
                this.facing = 'right';
                this.isMoving = true;
            }

            // Diagonal movement normalization
            if (this.vx !== 0 && this.vy !== 0) {
                this.vx *= 0.707;
                this.vy *= 0.707;
            }

            // Update position
            this.x += this.vx * dt;
            this.y += this.vy * dt;

            // Keep player in bounds
            this.x = Math.max(this.width/2, Math.min(canvas.width - this.width/2, this.x));
            this.y = Math.max(this.height/2, Math.min(canvas.height - this.height/2, this.y));

            // Update animation time
            if (this.isMoving) {
                this.animTime += dt * 8;
            }

            // Update trail effect
            this.trail.push({
                x: this.x,
                y: this.y,
                life: 1,
                time: Date.now()
            });

            // Remove old trail points
            this.trail = this.trail.filter(point => {
                point.life -= dt * 3;
                return point.life > 0;
            });

            // Regenerate energy slowly
            this.energy = Math.min(this.maxEnergy, this.energy + dt * 20);
        }

        render(ctx) {
            // Render trail effect
            this.trail.forEach((point, index) => {
                ctx.save();
                ctx.globalAlpha = point.life * 0.3;
                ctx.fillStyle = '#05d9e8';
                ctx.beginPath();
                ctx.arc(point.x, point.y, 3 * point.life, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });

            ctx.save();

            // Player body (animated if moving)
            const bobOffset = this.isMoving ? Math.sin(this.animTime) * 2 : 0;
            const playerY = this.y + bobOffset;

            // Player shadow
            ctx.save();
            ctx.globalAlpha = 0.3;
            ctx.fillStyle = '#000000';
            ctx.fillRect(this.x - this.width/2, this.y + this.height/2 - 2, this.width, 4);
            ctx.restore();

            // Player body (main)
            ctx.fillStyle = '#ff206e';
            ctx.fillRect(this.x - this.width/2, playerY - this.height/2, this.width, this.height);

            // Player glow effect
            ctx.save();
            ctx.shadowColor = '#ff206e';
            ctx.shadowBlur = 15;
            ctx.fillStyle = '#ff206e';
            ctx.fillRect(this.x - this.width/2 + 2, playerY - this.height/2 + 2, this.width - 4, this.height - 4);
            ctx.restore();

            // Player details
            ctx.fillStyle = '#00f593';
            const eyeOffset = this.facing === 'right' ? 4 : -4;
            ctx.fillRect(this.x - 6 + eyeOffset, playerY - 8, 3, 3);
            ctx.fillRect(this.x + 3 + eyeOffset, playerY - 8, 3, 3);

            // Chest emblem
            ctx.fillStyle = '#ffd700';
            ctx.fillRect(this.x - 4, playerY - 2, 8, 6);

            // Movement indicator
            if (this.isMoving) {
                ctx.fillStyle = '#00ff00';
                ctx.font = '12px monospace';
                ctx.textAlign = 'center';
                ctx.fillText('→', this.x, playerY - this.height/2 - 8);
            }

            ctx.restore();

            // Health bar
            this.renderHealthBar(ctx);
            // Energy bar
            this.renderEnergyBar(ctx);
        }

        renderHealthBar(ctx) {
            const barWidth = 40;
            const barHeight = 6;
            const barX = this.x - barWidth/2;
            const barY = this.y - this.height/2 - 15;

            // Background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(barX - 1, barY - 1, barWidth + 2, barHeight + 2);

            // Health bar
            const healthPercent = this.health / this.maxHealth;
            ctx.fillStyle = healthPercent > 0.5 ? '#00f593' : healthPercent > 0.25 ? '#ffd700' : '#ff206e';
            ctx.fillRect(barX, barY, barWidth * healthPercent, barHeight);
        }

        renderEnergyBar(ctx) {
            const barWidth = 40;
            const barHeight = 4;
            const barX = this.x - barWidth/2;
            const barY = this.y - this.height/2 - 8;

            // Background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(barX - 1, barY - 1, barWidth + 2, barHeight + 2);

            // Energy bar
            const energyPercent = this.energy / this.maxEnergy;
            ctx.fillStyle = '#05d9e8';
            ctx.fillRect(barX, barY, barWidth * energyPercent, barHeight);
        }

        dash(direction) {
            if (this.energy >= 25) {
                const dashDistance = 100;
                this.x += Math.cos(direction) * dashDistance;
                this.y += Math.sin(direction) * dashDistance;
                this.energy -= 25;

                // Keep in bounds after dash
                this.x = Math.max(this.width/2, Math.min(canvas.width - this.width/2, this.x));
                this.y = Math.max(this.height/2, Math.min(canvas.height - this.height/2, this.y));

                return true;
            }
            return false;
        }

        attack() {
            if (this.energy >= 15) {
                this.energy -= 15;
                return {
                    x: this.x + (this.facing === 'right' ? 30 : -30),
                    y: this.y,
                    damage: 25
                };
            }
            return null;
        }
    }

    // Simple particle class
    class DemoParticle {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.vx = (Math.random() - 0.5) * 200;
            this.vy = (Math.random() - 0.5) * 200;
            this.life = 1;
            this.decay = Math.random() * 0.02 + 0.01;
            this.size = Math.random() * 5 + 2;
            this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
        }

        update(dt) {
            this.x += this.vx * dt;
            this.y += this.vy * dt;
            this.life -= this.decay;
            this.vx *= 0.98;
            this.vy *= 0.98;
        }

        render(ctx) {
            ctx.save();
            ctx.globalAlpha = this.life;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }

    // Update and render click ripples
    setInterval(() => {
        ripples = ripples.filter(ripple => {
            ripple.radius += 2;
            ripple.life -= ripple.decay;

            if (ripple.life > 0) {
                ctx.save();
                ctx.globalAlpha = ripple.life * 0.5;
                ctx.strokeStyle = '#00f593';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(ripple.x, ripple.y, ripple.radius, 0, Math.PI * 2);
                ctx.stroke();

                // Inner ripple
                ctx.strokeStyle = '#ff206e';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(ripple.x, ripple.y, ripple.radius * 0.7, 0, Math.PI * 2);
                ctx.stroke();
                ctx.restore();
            }

            return ripple.life > 0 && ripple.radius < ripple.maxRadius;
        });
    }, 16);

    gameLoop();
}

const initGame = createSimpleDemo;

// Initialize everything
function initializeWithStyle() {
    const loadingScreen = document.getElementById('loadingScreen');

    setTimeout(async () => {
        try {
            await initGame();

            loadingScreen.style.transition = 'opacity 0.5s ease-out';
            loadingScreen.style.opacity = '0';

            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);

            // Initialize SaveManager after everything is loaded
            saveManager = new SaveManager();

            console.log('🎮 Game Engine Demo Ready!');
            console.log('📊 Features Demonstrated:');
            console.log('  • Real-time rendering');
            console.log('  • Particle systems');
            console.log('  • Input handling');
            console.log('  • Animation loops');
            console.log('  • Visual effects');
            console.log('  • Player character system');
            console.log('  • Save/Load system');
            console.log('💾 Use the Save/Load panel to save your game!');

        } catch (error) {
            console.error('Failed to initialize game:', error);
            loadingScreen.innerHTML = '<h2>❌ INITIALIZATION FAILED</h2><p>Check console for details</p>';
        }
    }, 1000);
}

// Responsive canvas handling
function resizeCanvas() {
    const canvas = document.querySelector('#gameCanvas');
    const container = document.querySelector('.game-container');

    if (canvas && container) {
        const containerRect = container.getBoundingClientRect();
        const maxWidth = containerRect.width - 40;
        const maxHeight = containerRect.height - 40;

        const aspectRatio = 1024 / 768;
        let newWidth = maxWidth;
        let newHeight = newWidth / aspectRatio;

        if (newHeight > maxHeight) {
            newHeight = maxHeight;
            newWidth = newHeight * aspectRatio;
        }

        canvas.style.width = newWidth + 'px';
        canvas.style.height = newHeight + 'px';
    }
}

window.addEventListener('resize', resizeCanvas);

// Prevent context menu on right click
document.addEventListener('contextmenu', (e) => {
    if (e.target.tagName === 'CANVAS') {
        e.preventDefault();
    }
});

// Initialize everything when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        resizeCanvas();
        initializeWithStyle();
    });
} else {
    resizeCanvas();
    initializeWithStyle();
}

console.log('🎮 Game Engine Demo Loading...');
console.log('💡 Tip: Open browser console to see engine logs');
console.log('🔧 Type gameEngineDebug.getEngineStats() for engine info');

// Global game state variables
let globalPlayer = null;
let globalScore = 0;
let globalClicks = 0;
let globalParticles = [];
let saveManager = null;

// Save/Load Management System
class SaveManager {
    constructor() {
        this.autoSaveInterval = null;
        this.lastSaveTime = Date.now();
        this.autoSaveDelay = 30000; // Auto-save every 30 seconds

        this.init();
        this.setupAutoSave();
    }

    init() {
        // Setup event listeners for save/load buttons
        this.setupSaveLoadButtons();
    }

    setupSaveLoadButtons() {
        // Save buttons
        document.getElementById('saveSlot1').addEventListener('click', () => this.saveGame('slot_0'));
        document.getElementById('saveSlot2').addEventListener('click', () => this.saveGame('slot_1'));
        document.getElementById('saveSlot3').addEventListener('click', () => this.saveGame('slot_2'));

        // Load buttons
        document.getElementById('loadSlot1').addEventListener('click', () => this.loadGame('slot_0'));
        document.getElementById('loadSlot2').addEventListener('click', () => this.loadGame('slot_1'));
        document.getElementById('loadSlot3').addEventListener('click', () => this.loadGame('slot_2'));

        // Export/Import buttons
        document.getElementById('exportSave').addEventListener('click', () => this.exportSave());
        document.getElementById('importSave').addEventListener('click', () => this.importSave());
        document.getElementById('importFileInput').addEventListener('change', (e) => this.handleImportFile(e));
    }

    saveGame(slot) {
        if (!globalPlayer) {
            this.showNotification('Player not initialized!', '#ff206e');
            return false;
        }

        try {
            const saveData = {
                player: {
                    x: globalPlayer.x,
                    y: globalPlayer.y,
                    health: globalPlayer.health,
                    maxHealth: globalPlayer.maxHealth,
                    energy: globalPlayer.energy,
                    maxEnergy: globalPlayer.maxEnergy,
                    facing: globalPlayer.facing,
                    isMoving: globalPlayer.isMoving,
                    animTime: globalPlayer.animTime,
                    trail: globalPlayer.trail
                },
                gameState: {
                    score: globalScore,
                    level: 1,
                    health: globalPlayer.health,
                    maxHealth: globalPlayer.maxHealth,
                    resources: {
                        energy: globalPlayer.energy,
                        mana: globalPlayer.energy * 0.5 // Convert energy to mana for ability system
                    },
                    persistent: {
                        particleCount: globalParticles.length,
                        clickCount: globalClicks
                    }
                },
                timestamp: Date.now(),
                version: '1.0.0'
            };

            localStorage.setItem(`game_save_${slot}`, JSON.stringify(saveData));
            this.showNotification(`Game saved to ${slot.replace('_', ' ')}!`, '#00f593');
            console.log(`Game saved to slot: ${slot}`);
            return true;
        } catch (error) {
            console.error('Failed to save game:', error);
            this.showNotification('Failed to save game!', '#ff206e');
            return false;
        }
    }

    loadGame(slot) {
        if (!globalPlayer) {
            this.showNotification('Player not initialized!', '#ff206e');
            return false;
        }

        try {
            const saveDataString = localStorage.getItem(`game_save_${slot}`);
            if (!saveDataString) {
                this.showNotification(`No save data found in ${slot.replace('_', ' ')}`, '#ffd700');
                return false;
            }

            const saveData = JSON.parse(saveDataString);

            // Restore player state
            if (saveData.player) {
                globalPlayer.x = saveData.player.x;
                globalPlayer.y = saveData.player.y;
                globalPlayer.health = saveData.player.health;
                globalPlayer.maxHealth = saveData.player.maxHealth;
                globalPlayer.energy = saveData.player.energy;
                globalPlayer.maxEnergy = saveData.player.maxEnergy;
                globalPlayer.facing = saveData.player.facing;
                globalPlayer.isMoving = saveData.player.isMoving;
                globalPlayer.animTime = saveData.player.animTime;
                globalPlayer.trail = saveData.player.trail || [];
            }

            // Restore game state
            if (saveData.gameState) {
                globalScore = saveData.gameState.score || 0;
                if (saveData.gameState.persistent) {
                    globalParticles = []; // Reset particles
                    globalClicks = saveData.gameState.persistent.clickCount || 0;
                }
            }

            this.showNotification(`Game loaded from ${slot.replace('_', ' ')}!`, '#00f593');
            console.log(`Game loaded from slot: ${slot}`);
            return true;
        } catch (error) {
            console.error('Failed to load game:', error);
            this.showNotification('Failed to load game!', '#ff206e');
            return false;
        }
    }

    exportSave() {
        try {
            const saveData = localStorage.getItem('game_save_slot_0'); // Export from slot 0
            if (!saveData) {
                this.showNotification('No save data to export!', '#ffd700');
                return false;
            }

            const blob = new Blob([saveData], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `game_save_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            this.showNotification('Save exported successfully!', '#00f593');
            return true;
        } catch (error) {
            console.error('Failed to export save:', error);
            this.showNotification('Failed to export save!', '#ff206e');
            return false;
        }
    }

    importSave() {
        document.getElementById('importFileInput').click();
    }

    handleImportFile(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const saveDataString = e.target.result;
                const saveData = JSON.parse(saveDataString);

                // Validate save data
                if (!saveData.gameState || !saveData.timestamp) {
                    throw new Error('Invalid save data format');
                }

                // Import to slot 0
                localStorage.setItem('game_save_slot_0', JSON.stringify(saveData));
                this.showNotification('Save imported successfully!', '#00f593');
                console.log('Save imported successfully');
            } catch (error) {
                console.error('Failed to import save:', error);
                this.showNotification('Invalid save file!', '#ff206e');
            }
        };
        reader.readAsText(file);
    }

    setupAutoSave() {
        this.autoSaveInterval = setInterval(() => {
            this.saveGame('auto_save');
            this.lastSaveTime = Date.now();
        }, this.autoSaveDelay);
    }

    showNotification(message, color = '#00f593') {
        const notification = document.getElementById('saveNotification');
        const notificationText = document.getElementById('notificationText');

        notificationText.textContent = message;
        notificationText.style.color = color;
        notification.style.display = 'block';

        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    destroy() {
        if (this.autoSaveInterval) {
            clearInterval(this.autoSaveInterval);
        }
    }
                // Get existing projects from localStorage
                let projects = [];
                const existing = localStorage.getItem('gameEngineProjects');
                if (existing) {
                    try {
                        projects = JSON.parse(existing);
                        if (!Array.isArray(projects)) {
                            projects = [];
                        }
                    } catch (e) {
                        projects = [];
                    }
                }

                // Check if project already exists
                const existingIndex = projects.findIndex(p => p.id === project.id);
                const isUpdate = existingIndex >= 0;

                if (isUpdate) {
                    projects[existingIndex] = project;
                    announceToScreenReader('Updating existing Neon Clicker project in localStorage...', 'assertive');
                } else {
                    projects.push(project);
                    announceToScreenReader('Adding new Neon Clicker project to localStorage...', 'assertive');
                }

                // Save back to localStorage
                localStorage.setItem('gameEngineProjects', JSON.stringify(projects));

                const statusMessage = isUpdate ?
                    'Neon Clicker project updated successfully in localStorage!' :
                    'Neon Clicker project added successfully to localStorage!';
                document.getElementById('status').innerHTML = '<p style="color: green;">✅ ' + statusMessage + '</p><p>You can now open the Project Manager to load this project.</p>';

                announceToScreenReader(statusMessage + ' You can now open the Project Manager to load this project.', 'assertive');

                return project;
            } catch (error) {
                const errorMessage = 'Error: ' + error.message;
                document.getElementById('status').innerHTML = '<p style="color: red;">❌ ' + errorMessage + '</p>';
                announceToScreenReader('Setup failed: ' + error.message, 'assertive');
                console.error('Setup error:', error);
                throw error;
            }
        }

        // Run setup when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeAccessibility();
            setupNeonProject();
        });

    </script>

</body>

</html>
